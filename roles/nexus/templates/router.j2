#jinja2: trim_blocks:False
! file generated by {{ username }}
!
hostname {{ hostname }}
username admin password {{ global.superuserpass }} role network-admin

! features
no feature telnet
feature ospf
feature tacacs+
feature ssh
feature lldp
feature ntp
feature interface-vlan

! general
ip name-server {{ global.dns_server }}
ip domain-name {{ global.dns_domain1 }}
service unsupported-transceiver

! aaa
aaa group server tacacs+ ANYCAST
aaa authentication login default group ANYCAST local
aaa authentication login console group ANYCAST local
aaa authorization commands default group ANYCAST local
aaa accounting default group ANYCAST
tacacs-server host {{ global.tacacs_server1 }} key 0 {{ global.tacacs_key }}
tacacs-server host {{ global.tacacs_server2 }} key 0 {{ global.tacacs_key }}
tacacs-server timeout 10
no tacacs-server directed-request
aaa group server tacacs+ ANYCAST
 server {{ global.tacacs_server1 }}
 server {{ global.tacacs_server2 }}
 use-vrf default
 source-interface {{ source_interface }}

! vlan
! needed to go above 512 vlans on a nexus
spanning-tree mode mst
vlan 6
  name Staging
vlan 9
  name BB
vlan 16
  name AP_Staging
vlan 19
  name AP_Management
vlan 29
  name CPE_Management
vlan 100-999

! management interface
interface {{ context.management_interface }}
  vrf member management
  ip address 192.168.100.1/24

! interfaces
{% for int in context.trunk_ports -%}
interface {{ int }}
 switchport trunk allowed vlan 6,9,16,19,29,100-999
 switchport mode trunk
 no shutdown
{%- endfor %}

{% for int in all_interfaces -%}
{% if int.value.assigned_object.name != 'Default Interface' %}
interface {{ int.value.assigned_object.name }}
  ip address {{ int.value.address }}
  no shut
{% if int.value.assigned_object.name == context.uplink_port %}
  description Uplink
  no switchport
  ip ospf network point-to-point
  no ip ospf passive-interface
  ip ospf mtu-ignore
  ip router ospf 1909 area 0.0.0.0
{% endif %}
{% endif %}
{%- endfor %}

! ospf
router ospf 1909
  router-id {{ router_id }}
  log-adjacency-changes
  passive-interface default


! acls
ip access-list Services_In
 permit ip host 172.18.0.242 any
 permit ip any host 172.18.0.242
 deny   udp any any range netbios-ns netbios-ss
 deny   tcp any any range 137 139
 deny   udp any any eq 19
 deny   tcp any any eq chargen
 deny   tcp any any eq 445
 deny   ip any host 239.255.255.250
 deny   tcp any any eq smtp
 deny   icmp any any redirect
 deny   icmp any any net-redirect
 permit ip any any
ip access-list Services_Out
 permit ip host 172.18.0.242 any
 permit udp host 10.136.162.84 any eq snmp
 permit ip any host 172.18.0.242
 permit udp host 65.182.32.34 any eq snmp
 permit udp host 65.182.32.37 any eq snmp
 permit udp host 65.50.1.18 any eq snmp
 permit udp 10.22.5.0 0.0.0.255 any eq snmp
 deny   udp any any eq snmp
 deny   udp any any range netbios-ns netbios-ss
 deny   tcp any any range 137 139
 deny   udp any any eq 19
 deny   tcp any any eq chargen
 deny   tcp any any eq 445
 deny   tcp any any eq smtp
 deny   tcp any any eq domain
 deny   udp any any eq domain
 deny   udp any any eq 1900
 deny   icmp any any redirect
 deny   icmp any any net-redirect
 permit ip any any
ip access-list deny_all
 deny ip any any
ip access-list vty_in
 permit ip host 65.50.0.9 any
 permit ip 172.24.0.0 0.0.255.255 any
 permit ip 172.18.0.0 0.0.255.255 any
 permit ip 10.136.80.0 0.0.7.255 any
 deny  ip any any
ip access-list allow_snmp_ro
 permit ip host 172.18.0.242 any
 permit ip host 65.50.0.9 any
 permit ip 10.136.80.0 0.0.7.255 any
 permit ip 10.136.160.0 0.0.7.255 any
 permit ip 10.22.5.0 0.0.0.255 any
 deny ip any  any
ip access-list ntp_servers
 permit ip host 172.18.0.244 any
 permit ip host 172.18.0.245 any
! logging
logging server {{ global.logging_host }}
logging source-interface {{ source_interface }}
! snmp
snmp source-interface {{ source_interface }}
snmp location {{ location }}
snmp community {{ global.snmp_community_string }} use-acl allow_snmp_ro
snmp contact {{ global.snmp_contact }}
! ntp
ntp server {{ global.ntp_server1 }}
ntp server {{ global.ntp_server2 }}
ntp source-interface {{ source_interface }}
ntp access-group query-only deny_all
ntp access-group peer ntp_servers
ntp access-group serve deny_all
ntp access-group serve-only deny_all

! vty
line vty
 access-class vty_in in



! banner
banner motd #

#
!
! aliases
cli alias name wr copy run start
end
